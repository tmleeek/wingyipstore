<?phpclass Wingyip_Irishosted_Helper_Data extends Mage_Core_Helper_Abstract{	const HASH_METHOD_MD5 = 'MD5';	const HASH_METHOD_SHA1 = 'SHA1';		const LOG_FILE_NAME = 'wingyip_irishosted.log';		const IRIS_SUB_ACCOUNT_INTERNET = 'internet';		public function getRedirectURL(){			/* Confuse for Redirect URL, Which url need to set.  		* Bellow URL from PDF Developer Guide for HPP .pdf page #9		*		* The URL for live transactions is: https://hpp.globaliris.com/pay		* The URL for test transactions is: https://hpp.sandbox.globaliris.com/pay		*		* In Sample Code (sample_67\RealAuthHPPphp) it shows below url		*		* https://hpp.realexpayments.com/pay				* https://hpp.sandbox.realexpayments.com/pay				*/				if(Mage::getModel('irishosted/irishosted')->getIsTestMode()){					return 'https://epage.payandshop.com/epage.cgi';//'https://hpp.sandbox.globaliris.com/pay';		}		return 'https://epage.payandshop.com/epage.cgi';//'https://hpp.globaliris.com/pay';				/*return 'https://redirect.globaliris.com/epage.cgi';*/	}		public function getResponseURL(){				}			/**     * Get Order Amount     * With Using Rounding Issue Fix     * @param Mage_Sales_Model_Order $order     * @return float     */    public function getOrderAmount($order)    {        /* At moment this function don't support discounts */        if (abs($order->getDiscountAmount()) > 0) {            return $order->getGrandTotal();        }        $amount = 0;        /* add Order Items */        $items = $order->getAllVisibleItems();        /** @var $item Mage_Sales_Model_Order_Item */        foreach ($items as $item) {            if ($item->getParentItem()) {                continue;            }            $itemQty = (int)$item->getQtyOrdered();            $priceWithTax = $item->getPriceInclTax();            $amount += round(100 * Mage::app()->getStore()->roundPrice($itemQty * $priceWithTax));        }                $discount = $order->getDiscountAmount();        $discount += $order->getShippingDiscountAmount();        $amount += round(100 * $discount);        /* add Shipping */        if (!$order->getIsVirtual()) {            $shippingIncTax = $order->getShippingInclTax();            $amount += round(100 * $shippingIncTax);        }        $grand_total = $order->getGrandTotal();        $amount = $amount / 100;        $abs = abs(Mage::app()->getStore()->roundPrice($amount) - Mage::app()->getStore()->roundPrice($grand_total));        /* Is ~0.010000000002037 */        if ($abs > 0 && $abs < 0.011) {            Mage::helper('irishosted')->debugLog('Warning: Price rounding issue. ' . $grand_total . ' vs ' . $amount);            return $amount;        } else {            return $grand_total;        }    }}
