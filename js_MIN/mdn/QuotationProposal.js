proposal={tab:null,titleToHTML:function(t){return"<h1>"+proposal.tab[t].title+"</h1>"},contentToHTML:function(t){var e="";switch(proposal.tab[t].mode){case"text":var n=new RegExp("\n","g"),o=proposal.tab[t].content;e="<p>"+o.replace(n,"<br/>")+"</p>";break;case"list":var i=proposal.tab[t].content,l=i.split("\n");e+='<ul class="list">';for(var a=0;a<l.length;a++)e+="<li>"+l[a]+"</li>";e+="</ul>"}return e},titleToEdit:function(t){return'<input id="edit_title_'+t+"\" onBlur=\"proposal.updateField(event, this.value, 'title', "+t+', this.parentNode);" type="text" value="'+proposal.tab[t].title+'" />'},contentToEdit:function(t){var e='<div class="proposal_content_container">';return e+='<div class="proposal_content_toolbar">',e+='<div class="proposal_content_toolbar_left">',e+=proposal.modeToEdit(t),e+='</div><div class="proposal_content_toolbar_right">',e+='<button onClick="proposal.removeSection('+t+');return false;">Delete</button>',e+="<button onClick=\"proposal.updateField(event, document.getElementById('edit_content_"+t+"').value, 'content', "+t+", document.getElementById('div_content_"+t+'\'));return false;" class="scalable save" type="button">Preview</button>',e+='</div></div><div class="proposal_content_textarea">',e+='<textarea id="edit_content_'+t+'" >'+proposal.tab[t].content+"</textarea></div></div>"},modeToEdit:function(t){var e="text"==proposal.tab[t].mode?"selected":"",n="list"==proposal.tab[t].mode?"selected":"",o='<label for="edit_mode_section_'+t+'">Display as </label> : <select name="edit_mode_section_'+t+'" id="edit_mode_section_'+t+"\" onChange=\"proposal.updateField(event, this.value, 'mode', "+t+', this.parentNode);">';return o+='<option value="text" '+e+">Text</option>",o+='<option value="list" '+n+">Liste</option>",o+="</select>"},switchTitleToEdit:function(t,e){return e.removeChild(e.firstChild),e.setAttribute("onClick",""),e.innerHTML=proposal.titleToEdit(t),document.getElementById("edit_title_"+t).focus(),!1},switchTitleToHTML:function(t,e){return e.removeChild(e.firstChild),e.setAttribute("onClick","proposal.switchTitleToEdit("+t+", this)"),e.innerHTML=proposal.titleToHTML(t),!1},switchContentToEdit:function(t,e){return e.removeChild(e.firstChild),e.setAttribute("onClick",""),e.innerHTML=proposal.contentToEdit(t),document.getElementById("edit_content_"+t).focus(),!1},switchContentToHTML:function(t,e){for(;e.firstChild;)e.removeChild(e.firstChild);return e.innerHTML=proposal.contentToHTML(t),e.setAttribute("onClick","proposal.switchContentToEdit("+t+", this)"),!1},updateField:function(t,e,n,o,i){switch(t||(t=window.event),t.cancelBuddle?t.cancelBuddle=!0:t.stopPropagation(),proposal.tab[o][n]=e,n){case"title":document.getElementById("title_section_"+o).value=e,proposal.switchTitleToHTML(o,i);break;case"content":document.getElementById("content_section_"+o).innerHTML=e,proposal.switchContentToHTML(o,i);break;case"mode":switch(e){case"text":document.getElementById("mode_section_"+o+"_text").checked=!0,document.getElementById("mode_section_"+o+"_list").checked=!1;break;case"list":document.getElementById("mode_section_"+o+"_text").checked=!1,document.getElementById("mode_section_"+o+"_list").checked=!0}}},init:function(t){this.tab=t;for(var e="",n=0;n<proposal.tab.length;n++)e+='<div id="section_'+n+'" class="proposal_section">',e+='<span onClick="proposal.switchTitleToEdit('+n+', this)">'+proposal.titleToHTML(n)+"</span>",e+='<div class="proposal_html_content" id="div_content_'+n+'" onClick="proposal.switchContentToEdit('+n+', this)">'+proposal.contentToHTML(n)+"</div>",e+="</div>";return document.getElementById("preview").innerHTML=e,!1},addSection:function(){var t=this.tab.length;this.tab[t]=new Array,this.tab[t].title="new title",this.tab[t].content="new content",this.tab[t].mode="text",this.addSectionToForm(t);var e="";return e='<div id="section_'+t+'" class="proposal_section">',e+='<span id="ancre_section_'+t+'" onClick="proposal.switchTitleToEdit('+t+', this)">'+this.titleToHTML(t)+"</span>",e+='<div class="proposal_html_content" id="div_content_'+t+'" onClick="proposal.switchContentToEdit('+t+', this)">'+this.contentToHTML(t)+"</div>",e+="</div>",document.getElementById("preview").innerHTML=document.getElementById("preview").innerHTML+e,window.location.href="#ancre_section_"+t,!1},removeSection:function(t){var e=document.getElementById("section_"+t);return e.style.display="none",document.getElementById("title_section_"+t).value="",document.getElementById("content_section_"+t).innerHtml="",!1},addSectionToForm:function(t){var e=document.createElement("ul"),n=document.createElement("label");n.setAttribute("for","title_section_"+t),n.innerHTML="Titre";var o=document.createElement("li");o.appendChild(n),e.appendChild(o);var i=document.createElement("input");i.setAttribute("name","myform[proposal][title_section_"+t+"]"),i.setAttribute("id","title_section_"+t),i.setAttribute("value","new title"),o=document.createElement("li"),o.appendChild(i),e.appendChild(o);var l=document.createElement("label");l.setAttribute("for","content_section_"+t),l.innerHTML="Content",o=document.createElement("li"),o.appendChild(l),e.appendChild(o);var a=document.createElement("textarea");a.setAttribute("name","myform[proposal][content_section_"+t+"]"),a.setAttribute("id","content_section_"+t),a.setAttribute("class","content_area"),a.innerHTML="new content",e.appendChild(document.createElement("li").appendChild(a)),o=document.createElement("li"),o.appendChild(a),e.appendChild(o);var d=document.createElement("label");d.setAttribute("for","mode_section_"+t+"_text"),d.innerHTML="Text";var c=document.createElement("input");c.setAttribute("type","radio"),c.setAttribute("name","myform[proposal][mode_section_"+t+"]"),c.setAttribute("id","mode_section_"+t+"_text"),c.setAttribute("value","text"),c.checked=!0,o=document.createElement("li"),o.appendChild(c),o.appendChild(d),e.appendChild(o),d=document.createElement("label"),d.setAttribute("for","mode_section_"+t+"_list"),d.innerHTML="List",c=document.createElement("input"),c.setAttribute("type","radio"),c.setAttribute("name","myform[proposal][mode_section_"+t+"]"),c.setAttribute("id","mode_section_"+t+"_list"),c.setAttribute("value","list"),o=document.createElement("li"),o.appendChild(c),o.appendChild(d),e.appendChild(o),document.getElementById("proposal_hidden_form").appendChild(e)}};