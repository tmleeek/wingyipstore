Ext.tree.TreePanel.prototype.getChecked=function(e){var t,i=[];if("undefined"==typeof e&&(e=this.getRootNode()),e.attributes.checked&&i.push(e.id),e.childNodes.length)for(t=0;t<e.childNodes.length;t++)i=i.concat(this.getChecked(e.childNodes[t]));return i},Ext.tree.CustomUITreeLoader=function(){Ext.tree.CustomUITreeLoader.superclass.constructor.apply(this,arguments)},Ext.extend(Ext.tree.CustomUITreeLoader,Ext.tree.TreeLoader,{createNode:function(attr){return Ext.apply(attr,this.baseAttr||{}),this.applyLoader!==!1&&(attr.loader=this),"string"==typeof attr.uiProvider&&(attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)),attr.leaf?new Ext.tree.TreeNode(attr):new Ext.tree.AsyncTreeNode(attr)}}),Ext.tree.CheckboxNodeUI=function(){Ext.tree.CheckboxNodeUI.superclass.constructor.apply(this,arguments)},Ext.extend(Ext.tree.CheckboxNodeUI,Ext.tree.TreeNodeUI,{render:function(e){var t=this.node,i=t.parentNode?t.parentNode.ui.getContainer():t.ownerTree.container.dom;if(this.rendered)e===!0&&i.appendChild(this.wrap);else{this.rendered=!0;var n=t.attributes;this.indentMarkup="",t.parentNode&&(this.indentMarkup=t.parentNode.ui.getChildIndent());var r=['<li class="x-tree-node"><div class="x-tree-node-el ',t.attributes.cls,'">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon">','<img src="',n.icon||this.emptyIcon,'" class="x-tree-node-icon',n.icon?" x-tree-node-inline-icon":"",n.iconCls?" "+n.iconCls:"",'" unselectable="on">','<input class="l-tcb" '+(t.disabled?'disabled="disabled" ':"")+' type="checkbox" ',n.checked?"checked>":">",'<a hidefocus="on" href="',n.href?n.href:"#",'" ',n.hrefTarget?' target="'+n.hrefTarget+'"':"",">",'<span unselectable="on">',t.text,"</span></a></div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"];this.wrap=e!==!0&&t.nextSibling&&t.nextSibling.ui.getEl()?Ext.DomHelper.insertHtml("beforeBegin",t.nextSibling.ui.getEl(),r.join("")):Ext.DomHelper.insertHtml("beforeEnd",i,r.join("")),this.elNode=this.wrap.childNodes[0],this.ctNode=this.wrap.childNodes[1];var o=this.elNode.childNodes;this.indentNode=o[0],this.ecNode=o[1],this.iconNode=o[2],this.checkbox=o[3],this.anchor=o[4],this.textNode=o[4].firstChild,n.qtip?this.textNode.setAttributeNS?(this.textNode.setAttributeNS("ext","qtip",n.qtip),n.qtipTitle&&this.textNode.setAttributeNS("ext","qtitle",n.qtipTitle)):(this.textNode.setAttribute("ext:qtip",n.qtip),n.qtipTitle&&this.textNode.setAttribute("ext:qtitle",n.qtipTitle)):n.qtipCfg&&(n.qtipCfg.target=Ext.id(this.textNode),Ext.QuickTips.register(n.qtipCfg)),this.initEvents(),Ext.fly(this.checkbox).on("click",this.check.createDelegate(this,[null])),t.on("dblclick",function(){this.isLeaf()&&this.getUI().toggleCheck()}),this.node.expanded||this.updateExpandIcon()}},checked:function(){return this.checkbox.checked},check:function(e,t,i){if(!this.node.disabled){var n=this.node,r=n.getOwnerTree(),o=n.parentNode;if(n.expanded||n.childrenRendered||n.expand(!1,!1,this.check.createDelegate(this,arguments)),"undefined"==typeof i&&(i=!1),"undefined"==typeof e||null===e?(e=this.checkbox.checked,t=!e,e&&n.expand(!1,!1)):this.checkbox.checked=e,n.attributes.checked=e,null!==o&&e&&o.getUI().check,t&&!n.isLeaf())for(var s=n.childNodes,c=0;c<s.length;c++);i||r.fireEvent("check",n,e)}},toggleCheck:function(){this.check(!this.checkbox.checked,!0)}}),Ext.tree.CheckNodeMultiSelectionModel=function(){Ext.tree.CheckNodeMultiSelectionModel.superclass.constructor.call(this)},Ext.extend(Ext.tree.CheckNodeMultiSelectionModel,Ext.tree.MultiSelectionModel,{init:function(e){this.tree=e,e.el.on("keydown",this.onKeyDown,this),e.on("click",this.onNodeClick,this)},onNodeClick:function(e,t){return e.disabled?void 0:t.shiftKey&&this.extendSelection(e)?!0:void(t.ctrlKey&&this.isSelected(e)?this.unselect(e):this.select(e,t,t.ctrlKey))},extendSelection:function(e){var t=this.lastSelNode;if(e==t||!t)return!1;if(e.parentNode==t.parentNode){var i=e.parentNode.childNodes,n=0,r="id",o=!1,s=!1;for(this.clearSelections(!0),n=0;n<i.length&&((i[n].attributes[r]==t.attributes[r]||i[n].attributes[r]==e.attributes[r])&&(s=o,o=!o),!o&&!s||(this.select(i[n],null,!0),!s));n++);return!0}return!1},onKeyDown:Ext.tree.DefaultSelectionModel.prototype.onKeyDown.createInterceptor(function(e){var t=this.selNode||this.lastSelNode;if(t){var i=e.getKey();switch(i){case e.SPACE:e.stopEvent();var n=this.getSelectedNodes(),r=!t.getUI().checked();if(1==n.length)t.getUI().check(r,!t.isLeaf());else for(var o=0;o<n.length;o++)n[o].getUI().check(r,!n[o].isLeaf())}return!0}})});