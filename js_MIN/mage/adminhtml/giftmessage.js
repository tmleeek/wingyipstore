function findFieldLabel(t){var i=$(t).up("td");if(i){var e=i.previous("td");if(e){var o=e.down("label");if(o)return o}}return!1}var giftMessagesController={toogleRequired:function(t,i){i.each($(t).value.blank()?function(i){$(t).formObj&&$(t).formObj.validator&&$(t).formObj.validator.reset(i),$(i).removeClassName("required-entry");var e=findFieldLabel($(i));if(e){var o=e.down("span");o&&Element.remove(o)}$(i)&&$(i).advices&&$(i).advices.each(function(t){null!=t.value&&t.value.hide()})}:function(t){$(t).addClassName("required-entry");var i=findFieldLabel($(t));if(i){var e=i.down("span");e||Element.insert(i,{bottom:'&nbsp;<span class="required">*</span>'})}})},toogleGiftMessage:function(t){if($(t).toogleGiftMessage){if($(t).toogleGiftMessage=!1,$(this.getFieldId(t,"message")).formObj=$(this.getFieldId(t,"form")),$(this.getFieldId(t,"form")).validator||($(this.getFieldId(t,"form")).validator=new Validation(this.getFieldId(t,"form"))),!$(this.getFieldId(t,"form")).validator.validate())return!1;new Ajax.Request($(this.getFieldId(t,"form")).action,{parameters:Form.serialize($(this.getFieldId(t,"form")),!0),loaderArea:t,onComplete:function(i){$(t).down(".action-link").removeClassName("open"),$(t).down(".default-text").show(),$(t).down(".close-text").hide(),$(this.getFieldId(t,"edit")).hide(),i.responseText.match(/YES/g)?($(t).down(".default-text").down(".edit").show(),$(t).down(".default-text").down(".add").hide()):($(t).down(".default-text").down(".add").show(),$(t).down(".default-text").down(".edit").hide())}.bind(this)})}else $(t).toogleGiftMessage=!0,$(this.getFieldId(t,"edit")).show(),$(t).down(".action-link").addClassName("open"),$(t).down(".default-text").hide(),$(t).down(".close-text").show();return!1},saveGiftMessage:function(t){$(this.getFieldId(t,"message")).formObj=$(this.getFieldId(t,"form")),$(this.getFieldId(t,"form")).validator||($(this.getFieldId(t,"form")).validator=new Validation(this.getFieldId(t,"form"))),$(this.getFieldId(t,"form")).validator.validate()&&new Ajax.Request($(this.getFieldId(t,"form")).action,{parameters:Form.serialize($(this.getFieldId(t,"form")),!0),loaderArea:t})},getFieldId:function(t,i){return t+"_"+i}},GiftOptionsPopup=Class.create();GiftOptionsPopup.prototype={giftOptionsWindowMask:null,giftOptionsWindow:null,initialize:function(){$$(".action-link").each(function(t){Event.observe(t,"click",this.showItemGiftOptions.bind(this))},this);var t=$("gift_options_configure");t&&t.remove();var i=$("gift_options_configure_new");$(document.body).insert({top:i}),i.id="gift_options_configure";var e=new Element("form",{action:"#",id:"gift_options_configuration_form",method:"post"}),o=$("gift_options_form_contents");o&&(o.parentNode.appendChild(e),e.appendChild(o))},showItemGiftOptions:function(t){var i=Event.element(t).id,e=i.sub("gift_options_link_","");toggleSelectsUnderBlock(this.giftOptionsWindowMask,!1),this.giftOptionsWindowMask=$("gift_options_window_mask"),this.giftOptionsWindow=$("gift_options_configure"),this.giftOptionsWindow.select("select").each(function(t){t.style.visibility="visible"}),this.giftOptionsWindowMask.setStyle({height:$("html-body").getHeight()+"px"}).show(),this.giftOptionsWindow.setStyle({marginTop:-this.giftOptionsWindow.getHeight()/2+"px",display:"block"}),this.setTitle(e),Event.observe($("gift_options_cancel_button"),"click",this.onCloseButton.bind(this)),Event.observe($("gift_options_ok_button"),"click",this.onOkButton.bind(this)),Event.stop(t)},setTitle:function(t){var i=$("order_item_"+t+"_title"),e="";i&&(e=i.innerHTML),$("gift_options_configure_title").update(e)},onOkButton:function(){var t=new varienForm("gift_options_configuration_form");return t.canShowError=!0,t.validate()?(t.validator.reset(),this.closeWindow(),!0):!1},onCloseButton:function(){this.closeWindow()},closeWindow:function(){toggleSelectsUnderBlock(this.giftOptionsWindowMask,!0),this.giftOptionsWindowMask.style.display="none",this.giftOptionsWindow.style.display="none"}},GiftMessageSet=Class.create(),GiftMessageSet.prototype={destPrefix:"current_item_giftmessage_",sourcePrefix:"giftmessage_",fields:["sender","recipient","message"],isObserved:!1,initialize:function(){$$(".action-link").each(function(t){Event.observe(t,"click",this.setData.bind(this))},this)},setData:function(t){var i=Event.element(t).id;this.id=i.sub("gift_options_link_",""),$("gift-message-form-data-"+this.id)?(this.fields.each(function(t){$(this.sourcePrefix+this.id+"_"+t)&&$(this.destPrefix+t)&&($(this.destPrefix+t).value=$(this.sourcePrefix+this.id+"_"+t).value)},this),$("gift_options_giftmessage").show()):$("gift_options_giftmessage").hide(),this.isObserved||(Event.observe("gift_options_ok_button","click",this.saveData.bind(this)),this.isObserved=!0)},saveData:function(){if(this.fields.each(function(t){$(this.sourcePrefix+this.id+"_"+t)&&$(this.destPrefix+t)&&($(this.sourcePrefix+this.id+"_"+t).value=$(this.destPrefix+t).value)},this),$(this.sourcePrefix+this.id+"_form"))$(this.sourcePrefix+this.id+"_form").request();else if("undefined"!=typeof order){var t=order.serializeData("gift_options_data_"+this.id);order.loadArea(["items"],!0,t.toObject())}}};