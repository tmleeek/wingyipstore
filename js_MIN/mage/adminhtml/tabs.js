var varienTabs=new Class.create;varienTabs.prototype={initialize:function(t,e,a,s){this.containerId=t,this.destElementId=e,this.activeTab=null,this.tabOnClick=this.tabMouseClick.bindAsEventListener(this),this.tabs=$$("#"+this.containerId+" li a.tab-item-link"),this.hideAllTabsContent();for(var n=0;n<this.tabs.length;n++){if(Event.observe(this.tabs[n],"click",this.tabOnClick),$(this.destElementId)){var i=$(this.getTabContentElementId(this.tabs[n]));i&&i.parentNode.id!=this.destElementId&&($(this.destElementId).appendChild(i),i.container=this,i.statusBar=this.tabs[n],i.tabObject=this.tabs[n],this.tabs[n].contentMoved=!0,this.tabs[n].container=this,this.tabs[n].show=function(){this.container.showTabContent(this)},varienGlobalEvents&&varienGlobalEvents.fireEvent("moveTab",{tab:this.tabs[n]}))}this.tabs[n].id&&s&&s[this.tabs[n].id]&&(this.tabs[n].shadowTabs=s[this.tabs[n].id])}this.displayFirst=a,Event.observe(window,"load",this.moveTabContentInDest.bind(this))},setSkipDisplayFirstTab:function(){this.displayFirst=null},moveTabContentInDest:function(){for(var t=0;t<this.tabs.length;t++)if($(this.destElementId)&&!this.tabs[t].contentMoved){var e=$(this.getTabContentElementId(this.tabs[t]));e&&e.parentNode.id!=this.destElementId&&($(this.destElementId).appendChild(e),e.container=this,e.statusBar=this.tabs[t],e.tabObject=this.tabs[t],this.tabs[t].container=this,this.tabs[t].show=function(){this.container.showTabContent(this)},varienGlobalEvents&&varienGlobalEvents.fireEvent("moveTab",{tab:this.tabs[t]}))}this.displayFirst&&(this.showTabContent($(this.displayFirst)),this.displayFirst=null)},getTabContentElementId:function(t){return t?t.id+"_content":!1},tabMouseClick:function(t){var e=Event.findElement(t,"a");e.href.indexOf("#")==e.href.length-1||Element.hasClassName(e,"ajax")?this.showTabContent(e):location.href=e.href,Event.stop(t)},hideAllTabsContent:function(){for(var t in this.tabs)this.hideTabContent(this.tabs[t])},showTabContentImmediately:function(t){this.hideAllTabsContent();var e=$(this.getTabContentElementId(t));if(e){if(Element.show(e),Element.addClassName(t,"active"),t.shadowTabs&&t.shadowTabs.length)for(var a in t.shadowTabs)this.loadShadowTab($(t.shadowTabs[a]));Element.hasClassName(t,"ajax only")||Element.removeClassName(t,"notloaded"),this.activeTab=t}varienGlobalEvents&&varienGlobalEvents.fireEvent("showTab",{tab:t})},showTabContent:function(t){var e=$(this.getTabContentElementId(t));if(e){if(this.activeTab!=t&&varienGlobalEvents&&-1!=varienGlobalEvents.fireEvent("tabChangeBefore",$(this.getTabContentElementId(this.activeTab))).indexOf("cannotchange"))return;var a=Element.hasClassName(t,"ajax"),s=""==e.innerHTML&&t.href.indexOf("#")!=t.href.length-1,n=Element.hasClassName(t,"notloaded");a&&(s||n)?new Ajax.Request(t.href,{parameters:{form_key:FORM_KEY},evalScripts:!0,onSuccess:function(a){try{if(a.responseText.isJSON()){var s=a.responseText.evalJSON();s.error&&alert(s.message),s.ajaxExpired&&s.ajaxRedirect&&setLocation(s.ajaxRedirect)}else $(e.id).update(a.responseText),this.showTabContentImmediately(t)}catch(n){$(e.id).update(a.responseText),this.showTabContentImmediately(t)}}.bind(this)}):this.showTabContentImmediately(t)}},loadShadowTab:function(t){var e=$(this.getTabContentElementId(t));e&&Element.hasClassName(t,"ajax")&&Element.hasClassName(t,"notloaded")&&new Ajax.Request(t.href,{parameters:{form_key:FORM_KEY},evalScripts:!0,onSuccess:function(a){try{if(a.responseText.isJSON()){var s=a.responseText.evalJSON();s.error&&alert(s.message),s.ajaxExpired&&s.ajaxRedirect&&setLocation(s.ajaxRedirect)}else $(e.id).update(a.responseText),Element.hasClassName(t,"ajax only")||Element.removeClassName(t,"notloaded")}catch(n){$(e.id).update(a.responseText),Element.hasClassName(t,"ajax only")||Element.removeClassName(t,"notloaded")}}.bind(this)})},hideTabContent:function(t){var e=$(this.getTabContentElementId(t));$(this.destElementId)&&e&&(Element.hide(e),Element.removeClassName(t,"active")),varienGlobalEvents&&varienGlobalEvents.fireEvent("hideTab",{tab:t})}};