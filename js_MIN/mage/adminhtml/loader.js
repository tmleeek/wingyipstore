function setLoaderPosition(){var e=$("loading_mask_loader");if(e&&Prototype.Browser.IE){var t=e.getDimensions(),i=document.viewport.getDimensions(),o=document.viewport.getScrollOffsets();e.style.left=Math.floor(i.width/2+o.left-t.width/2)+"px",e.style.top=Math.floor(i.height/2+o.top-t.height/2)+"px",e.style.position="absolute"}}function toggleSelectsUnderBlock(e,t){if(Prototype.Browser.IE)for(var i=document.getElementsByTagName("select"),o=0;o<i.length;o++)t?i[o].needShowOnSuccess&&(i[o].needShowOnSuccess=!1,i[o].style.visibility=""):Element.visible(i[o])&&(i[o].style.visibility="hidden",i[o].needShowOnSuccess=!0)}var SessionError=Class.create();SessionError.prototype={initialize:function(e){this.errorText=e},toString:function(){return"Session Error:"+this.errorText}},Ajax.Request.addMethods({initialize:function(e,t,i){e(i),this.transport=Ajax.getTransport(),t.match(new RegExp("[?&]isAjax=true",""))||(t=t.match(new RegExp("\\?","g"))?t+"&isAjax=true":t+"?isAjax=true"),Object.isString(this.options.parameters)&&-1==this.options.parameters.indexOf("form_key=")?this.options.parameters+="&"+Object.toQueryString({form_key:FORM_KEY}):(this.options.parameters||(this.options.parameters={form_key:FORM_KEY}),this.options.parameters.form_key||(this.options.parameters.form_key=FORM_KEY)),this.request(t)},respondToReadyState:function(e){var t=Ajax.Request.Events[e],i=new Ajax.Response(this);if("Complete"==t){try{if(this._complete=!0,i.responseText.isJSON()){var o=i.responseText.evalJSON();if(o.ajaxExpired&&o.ajaxRedirect)throw window.location.replace(o.ajaxRedirect),new SessionError("session expired")}(this.options["on"+i.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(i,i.headerJSON)}catch(s){if(this.dispatchException(s),s instanceof SessionError)return}var a=i.getHeader("Content-type");("force"==this.options.evalJS||this.options.evalJS&&this.isSameOrigin()&&a&&a.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))&&this.evalResponse()}try{(this.options["on"+t]||Prototype.emptyFunction)(i,i.headerJSON),Ajax.Responders.dispatch("on"+t,this,i,i.headerJSON)}catch(s){this.dispatchException(s)}"Complete"==t&&(this.transport.onreadystatechange=Prototype.emptyFunction)}}),Ajax.Updater.respondToReadyState=Ajax.Request.respondToReadyState;var varienLoader=new Class.create;if(varienLoader.prototype={initialize:function(e){this.callback=!1,this.cache=$H(),this.caching=e||!1,this.url=!1},getCache:function(e){return this.cache.get(e)?this.cache.get(e):!1},load:function(e,t,i){if(this.url=e,this.callback=i,this.caching){var o=this.getCache(e);if(o)return void this.processResult(o)}"undefined"!=typeof t.updaterId?new varienUpdater(t.updaterId,e,{evalScripts:!0,onComplete:this.processResult.bind(this),onFailure:this._processFailure.bind(this)}):new Ajax.Request(e,{method:"post",parameters:t||{},onComplete:this.processResult.bind(this),onFailure:this._processFailure.bind(this)})},_processFailure:function(){location.href=BASE_URL},processResult:function(e){this.caching&&this.cache.set(this.url,e),this.callback&&this.callback(e.responseText)}},!window.varienLoaderHandler)var varienLoaderHandler=new Object;varienLoaderHandler.handler={onCreate:function(e){e.options.loaderArea!==!1&&(e.options.loaderArea=$$("#html-body .wrapper")[0],e&&e.options.loaderArea&&(Element.clonePosition($("loading-mask"),$(e.options.loaderArea),{offsetLeft:-2}),toggleSelectsUnderBlock($("loading-mask"),!1),Element.show("loading-mask"),setLoaderPosition(),"html-body"==e.options.loaderArea))},onComplete:function(){0==Ajax.activeRequestCount&&(toggleSelectsUnderBlock($("loading-mask"),!0),Element.hide("loading-mask"))}},Ajax.Responders.register(varienLoaderHandler.handler);var varienUpdater=Class.create(Ajax.Updater,{updateContent:function(e,t){if(t.isJSON()){var i=t.evalJSON();i.ajaxExpired&&i.ajaxRedirect&&window.location.replace(i.ajaxRedirect)}else e(t)}});