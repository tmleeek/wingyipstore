function openGridRow(e,t){var i=Event.findElement(t,"tr");-1==["a","input","select","option"].indexOf(Event.element(t).tagName.toLowerCase())&&i.title&&setLocation(i.title)}var varienGrid=new Class.create;varienGrid.prototype={initialize:function(e,t,i,n,s,a){this.containerId=e,this.url=t,this.pageVar=i||!1,this.sortVar=n||!1,this.dirVar=s||!1,this.filterVar=a||!1,this.tableSufix="_table",this.useAjax=!1,this.rowClickCallback=!1,this.checkboxCheckCallback=!1,this.preInitCallback=!1,this.initCallback=!1,this.initRowCallback=!1,this.doFilterCallback=!1,this.reloadParams=!1,this.trOnMouseOver=this.rowMouseOver.bindAsEventListener(this),this.trOnMouseOut=this.rowMouseOut.bindAsEventListener(this),this.trOnClick=this.rowMouseClick.bindAsEventListener(this),this.trOnDblClick=this.rowMouseDblClick.bindAsEventListener(this),this.trOnKeyPress=this.keyPress.bindAsEventListener(this),this.thLinkOnClick=this.doSort.bindAsEventListener(this),this.initGrid()},initGrid:function(){if(this.preInitCallback&&this.preInitCallback(this),$(this.containerId+this.tableSufix)){this.rows=$$("#"+this.containerId+this.tableSufix+" tbody tr");for(var e=0;e<this.rows.length;e++)e%2==0&&Element.addClassName(this.rows[e],"even"),Event.observe(this.rows[e],"mouseover",this.trOnMouseOver),Event.observe(this.rows[e],"mouseout",this.trOnMouseOut),Event.observe(this.rows[e],"click",this.trOnClick),Event.observe(this.rows[e],"dblclick",this.trOnDblClick)}if(this.sortVar&&this.dirVar)for(var t=$$("#"+this.containerId+this.tableSufix+" thead a"),i=0;i<t.length;i++)Event.observe(t[i],"click",this.thLinkOnClick);if(this.bindFilterFields(),this.bindFieldsChange(),this.initCallback)try{this.initCallback(this)}catch(n){console&&console.log(n)}},initGridAjax:function(){this.initGrid(),this.initGridRows()},initGridRows:function(){if(this.initRowCallback)for(var e=0;e<this.rows.length;e++)try{this.initRowCallback(this,this.rows[e])}catch(t){console&&console.log(t)}},getContainerId:function(){return this.containerId},rowMouseOver:function(e){var t=Event.findElement(e,"tr");t.title&&(Element.addClassName(t,"on-mouse"),Element.hasClassName("pointer")||this.rowClickCallback===openGridRow&&!t.title||t.title&&Element.addClassName(t,"pointer"))},rowMouseOut:function(e){var t=Event.findElement(e,"tr");Element.removeClassName(t,"on-mouse")},rowMouseClick:function(e){if(this.rowClickCallback)try{this.rowClickCallback(this,e)}catch(t){}varienGlobalEvents.fireEvent("gridRowClick",e)},rowMouseDblClick:function(e){varienGlobalEvents.fireEvent("gridRowDblClick",e)},keyPress:function(){},doSort:function(e){var t=Event.findElement(e,"a");return t.name&&t.title&&(this.addVarToUrl(this.sortVar,t.name),this.addVarToUrl(this.dirVar,t.title),this.reload(this.url)),Event.stop(e),!1},loadByElement:function(e){e&&e.name&&this.reload(this.addVarToUrl(e.name,e.value))},reload:function(e){return this.reloadParams?this.reloadParams.form_key=FORM_KEY:this.reloadParams={form_key:FORM_KEY},e=e||this.url,this.useAjax?void new Ajax.Request(e+(e.match(new RegExp("\\?"))?"&ajax=true":"?ajax=true"),{loaderArea:this.containerId,parameters:this.reloadParams||{},evalScripts:!0,onFailure:this._processFailure.bind(this),onComplete:this.initGridAjax.bind(this),onSuccess:function(e){try{var t=e.responseText.replace(/>\s+</g,"><");if(e.responseText.isJSON()){var i=e.responseText.evalJSON();i.error&&alert(i.message),i.ajaxExpired&&i.ajaxRedirect&&setLocation(i.ajaxRedirect)}else{var n=$(this.containerId);n.id==this.containerId?n.update(t):$$('div[id="'+this.containerId+'"]')[0].update(t)}}catch(s){var n=$(this.containerId);n.id==this.containerId?n.update(t):$$('div[id="'+this.containerId+'"]')[0].update(t)}}.bind(this)}):(this.reloadParams&&$H(this.reloadParams).each(function(t){e=this.addVarToUrl(t.key,t.value)}.bind(this)),void(location.href=e))},_processFailure:function(){location.href=BASE_URL},_addVarToUrl:function(e,t,i){var n=new RegExp("/("+t+"/.*?/)"),s=e.split(new RegExp("\\?"));return e=s[0].replace(n,"/"),e+=t+"/"+i+"/",s.size()>1&&(e+="?"+s[1]),e},addVarToUrl:function(e,t){return this.url=this._addVarToUrl(this.url,e,t),this.url},doExport:function(){if($(this.containerId+"_export")){var e=$(this.containerId+"_export").value;this.massaction&&this.massaction.checkedString&&(e=this._addVarToUrl(e,this.massaction.formFieldNameInternal,this.massaction.checkedString)),location.href=e}},bindFilterFields:function(){for(var e=$$("#"+this.containerId+" .filter input","#"+this.containerId+" .filter select"),t=0;t<e.length;t++)Event.observe(e[t],"keypress",this.filterKeyPress.bind(this))},bindFieldsChange:function(){if($(this.containerId))for(var e=$(this.containerId+this.tableSufix).down("tbody").select("input","select"),t=0;t<e.length;t++)Event.observe(e[t],"change",e[t].setHasChanges.bind(e[t]))},filterKeyPress:function(e){e.keyCode==Event.KEY_RETURN&&this.doFilter()},doFilter:function(){var e=$$("#"+this.containerId+" .filter input","#"+this.containerId+" .filter select"),t=[];for(var i in e)e[i].value&&e[i].value.length&&t.push(e[i]);(!this.doFilterCallback||this.doFilterCallback&&this.doFilterCallback())&&this.reload(this.addVarToUrl(this.filterVar,encode_base64(Form.serializeElements(t))))},resetFilter:function(){this.reload(this.addVarToUrl(this.filterVar,""))},checkCheckboxes:function(e){elements=Element.select($(this.containerId),'input[name="'+e.name+'"]');for(var t=0;t<elements.length;t++)this.setCheckboxChecked(elements[t],e.checked)},setCheckboxChecked:function(e,t){e.checked=t,e.setHasChanges({}),this.checkboxCheckCallback&&this.checkboxCheckCallback(this,e,t)},inputPage:function(e){var t=Event.element(e),i=e.keyCode||e.which;i==Event.KEY_RETURN&&this.setPage(t.value)},setPage:function(e){this.reload(this.addVarToUrl(this.pageVar,e))}};var varienGridMassaction=Class.create();varienGridMassaction.prototype={checkedValues:$H({}),checkedString:"",oldCallbacks:{},errorText:"",items:{},gridIds:[],useSelectAll:!1,currentItem:!1,lastChecked:{left:!1,top:!1,checkbox:!1},fieldTemplate:new Template('<input type="hidden" name="#{name}" value="#{value}" />'),initialize:function(e,t,i,n,s){this.setOldCallback("row_click",t.rowClickCallback),this.setOldCallback("init",t.initCallback),this.setOldCallback("init_row",t.initRowCallback),this.setOldCallback("pre_init",t.preInitCallback),this.useAjax=!1,this.grid=t,this.grid.massaction=this,this.containerId=e,this.initMassactionElements(),this.checkedString=i,this.formFieldName=s,this.formFieldNameInternal=n,this.grid.initCallback=this.onGridInit.bind(this),this.grid.preInitCallback=this.onGridPreInit.bind(this),this.grid.initRowCallback=this.onGridRowInit.bind(this),this.grid.rowClickCallback=this.onGridRowClick.bind(this),this.initCheckboxes(),this.checkCheckboxes()},setUseAjax:function(e){this.useAjax=e},setUseSelectAll:function(e){this.useSelectAll=e},initMassactionElements:function(){this.container=$(this.containerId),this.count=$(this.containerId+"-count"),this.formHiddens=$(this.containerId+"-form-hiddens"),this.formAdditional=$(this.containerId+"-form-additional"),this.select=$(this.containerId+"-select"),this.form=this.prepareForm(),this.validator=new Validation(this.form),this.select.observe("change",this.onSelectChange.bindAsEventListener(this)),this.lastChecked={left:!1,top:!1,checkbox:!1},this.initMassSelect()},prepareForm:function(){var e=$(this.containerId+"-form"),t=null,i=this.formHiddens||this.formAdditional;return i||(i=this.container.getElementsByTagName("button")[0],i&&i.parentNode),!e&&i&&(e=document.createElement("form"),e.setAttribute("method","post"),e.setAttribute("action",""),e.id=this.containerId+"-form",t=i.parentNode.parentNode,t.parentNode.appendChild(e),e.appendChild(t)),e},setGridIds:function(e){this.gridIds=e,this.updateCount()},getGridIds:function(){return this.gridIds},setItems:function(e){this.items=e,this.updateCount()},getItems:function(){return this.items},getItem:function(e){return this.items[e]?this.items[e]:!1},getOldCallback:function(e){return this.oldCallbacks[e]?this.oldCallbacks[e]:Prototype.emptyFunction},setOldCallback:function(e,t){this.oldCallbacks[e]=t},onGridPreInit:function(e){this.initMassactionElements(),this.getOldCallback("pre_init")(e)},onGridInit:function(e){this.initCheckboxes(),this.checkCheckboxes(),this.updateCount(),this.getOldCallback("init")(e)},onGridRowInit:function(e,t){this.getOldCallback("init_row")(e,t)},onGridRowClick:function(e,t){var i=Event.findElement(t,"td"),n=Event.findElement(t,"tr");if($(i).down("input"))Event.element(t).isMassactionCheckbox?this.setCheckbox(Event.element(t)):(s=this.findCheckbox(t))&&(s.checked=!s.checked,this.setCheckbox(s));else{if($(i).down("a")||$(i).down("select"))return;if(n.title)setLocation(n.title);else{var s=Element.select(n,"input"),a="input"==Event.element(t).tagName,r=a?s[0].checked:!s[0].checked;this.checkedString=r?varienStringArray.add(s[0].value,this.checkedString):varienStringArray.remove(s[0].value,this.checkedString),this.grid.setCheckboxChecked(s[0],r),this.updateCount()}}},onSelectChange:function(){var e=this.getSelectedItem();this.formAdditional.update(e?$(this.containerId+"-item-"+e.id+"-block").innerHTML:""),this.validator.reset()},findCheckbox:function(e){return-1!==["a","input","select"].indexOf(Event.element(e).tagName.toLowerCase())?!1:(checkbox=!1,Event.findElement(e,"tr").select(".massaction-checkbox").each(function(e){e.isMassactionCheckbox&&(checkbox=e)}.bind(this)),checkbox)},initCheckboxes:function(){this.getCheckboxes().each(function(e){e.isMassactionCheckbox=!0}.bind(this))},checkCheckboxes:function(){this.getCheckboxes().each(function(e){e.checked=varienStringArray.has(e.value,this.checkedString)}.bind(this))},selectAll:function(){return this.setCheckedValues(this.useSelectAll?this.getGridIds():this.getCheckboxesValuesAsString()),this.checkCheckboxes(),this.updateCount(),this.clearLastChecked(),!1},unselectAll:function(){return this.setCheckedValues(""),this.checkCheckboxes(),this.updateCount(),this.clearLastChecked(),!1},selectVisible:function(){return this.setCheckedValues(this.getCheckboxesValuesAsString()),this.checkCheckboxes(),this.updateCount(),this.clearLastChecked(),!1},unselectVisible:function(){return this.getCheckboxesValues().each(function(e){this.checkedString=varienStringArray.remove(e,this.checkedString)}.bind(this)),this.checkCheckboxes(),this.updateCount(),this.clearLastChecked(),!1},setCheckedValues:function(e){this.checkedString=e},getCheckedValues:function(){return this.checkedString},getCheckboxes:function(){var e=[];return this.grid.rows.each(function(t){var i=t.select(".massaction-checkbox");i.each(function(t){e.push(t)})}),e},getCheckboxesValues:function(){var e=[];return this.getCheckboxes().each(function(t){e.push(t.value)}.bind(this)),e},getCheckboxesValuesAsString:function(){return this.getCheckboxesValues().join(",")},setCheckbox:function(e){this.checkedString=e.checked?varienStringArray.add(e.value,this.checkedString):varienStringArray.remove(e.value,this.checkedString),this.updateCount()},updateCount:function(){this.count.update(varienStringArray.count(this.checkedString)),this.grid.reloadParams||(this.grid.reloadParams={}),this.grid.reloadParams[this.formFieldNameInternal]=this.checkedString},getSelectedItem:function(){return this.getItem(this.select.value)?this.getItem(this.select.value):!1},apply:function(){if(0==varienStringArray.count(this.checkedString))return void alert(this.errorText);var e=this.getSelectedItem();if(!e)return void this.validator.validate();this.currentItem=e;var t=e.field?e.field:this.formFieldName;(!this.currentItem.confirm||window.confirm(this.currentItem.confirm))&&(this.formHiddens.update(""),new Insertion.Bottom(this.formHiddens,this.fieldTemplate.evaluate({name:t,value:this.checkedString})),new Insertion.Bottom(this.formHiddens,this.fieldTemplate.evaluate({name:"massaction_prepare_key",value:t})),this.validator.validate()&&(this.useAjax&&e.url?new Ajax.Request(e.url,{method:"post",parameters:this.form.serialize(!0),onComplete:this.onMassactionComplete.bind(this)}):e.url&&(this.form.action=e.url,this.form.submit())))},onMassactionComplete:function(e){if(this.currentItem.complete)try{var t=this.getListener(this.currentItem.complete)||Prototype.emptyFunction;t(this.grid,this,e)}catch(i){}},getListener:function(strValue){return eval(strValue)},initMassSelect:function(){$$('input[class~="massaction-checkbox"]').each(function(e){e.observe("click",this.massSelect.bind(this))}.bind(this))},clearLastChecked:function(){this.lastChecked={left:!1,top:!1,checkbox:!1}},massSelect:function(e){if(this.lastChecked.left!==!1&&this.lastChecked.top!==!1&&0===e.button&&e.shiftKey===!0){var t=Event.element(e),i=this.lastChecked.checkbox;if(i!=t){var n=this.getCheckboxOrder(i),s=this.getCheckboxOrder(t);n!==!1&&s!==!1&&this.selectCheckboxRange(Math.min(n,s),Math.max(n,s),t.checked)}}this.lastChecked={left:Event.element(e).viewportOffset().left,top:Event.element(e).viewportOffset().top,checkbox:Event.element(e)}},getCheckboxOrder:function(e){var t=!1;return this.getCheckboxes().each(function(i,n){e==i&&(t=n)}),t},selectCheckboxRange:function(e,t,i){this.getCheckboxes().each(function(n,s){s>=e&&t>=s&&(n.checked=i,this.setCheckbox(n))}.bind(this))}};var varienGridAction={execute:function(e){if(e.value&&e.value.isJSON()){var t=e.value.evalJSON();if(t.confirm&&!window.confirm(t.confirm))return void(e.options[0].selected=!0);if(t.popup){var i=window.open(t.href,"action_window","width=500,height=600,resizable=1,scrollbars=1");i.focus(),e.options[0].selected=!0}else setLocation(t.href)}}},varienStringArray={remove:function(e,t){return t=","+t+",",t=t.replace(new RegExp(","+e+",","g"),","),this.trimComma(t)},add:function(e,t){return t=","+t+",",-1===t.search(new RegExp(","+e+",","g"),t)&&(t+=e+","),this.trimComma(t)},has:function(e,t){return t=","+t+",",-1===t.search(new RegExp(","+e+",","g"),t)?!1:!0},count:function(e){return"string"!=typeof e?0:(match=e.match(new RegExp(",","g")))?match.length+1:0!=e.length?1:0},each:function(e,t){for(var e=e.split(","),i=0;i<e.length;i++)t(e[i])},trimComma:function(e){return e=e.replace(new RegExp("^(,+)","i"),""),e=e.replace(new RegExp("(,+)$","i"),"")}},serializerController=Class.create();serializerController.prototype={oldCallbacks:{},initialize:function(e,t,i,n,s){this.tabIndex=1e3,this.inputsToManage=i,this.multidimensionalMode=i.length>0,this.gridData=this.getGridDataHash(t),this.hiddenDataHolder=$(e),this.hiddenDataHolder.value=this.serializeObject(),this.grid=n,this.setOldCallback("row_click",this.grid.rowClickCallback),this.setOldCallback("init_row",this.grid.initRowCallback),this.setOldCallback("checkbox_check",this.grid.checkboxCheckCallback),this.reloadParamName=s,this.grid.reloadParams={},this.grid.reloadParams[this.reloadParamName+"[]"]=this.getDataForReloadParam(),this.grid.rowClickCallback=this.rowClick.bind(this),this.grid.initRowCallback=this.rowInit.bind(this),this.grid.checkboxCheckCallback=this.registerData.bind(this),this.grid.rows.each(this.eachRow.bind(this))},setOldCallback:function(e,t){this.oldCallbacks[e]=t},getOldCallback:function(e){return this.oldCallbacks[e]?this.oldCallbacks[e]:Prototype.emptyFunction},registerData:function(e,t,i){if(this.multidimensionalMode)if(i){if(t.inputElements){this.gridData.set(t.value,{});for(var n=0;n<t.inputElements.length;n++)t.inputElements[n].disabled=!1,this.gridData.get(t.value)[t.inputElements[n].name]=t.inputElements[n].value}}else{if(t.inputElements)for(var n=0;n<t.inputElements.length;n++)t.inputElements[n].disabled=!0;this.gridData.unset(t.value)}else i?this.gridData.set(t.value,t.value):this.gridData.unset(t.value);this.hiddenDataHolder.value=this.serializeObject(),this.grid.reloadParams={},this.grid.reloadParams[this.reloadParamName+"[]"]=this.getDataForReloadParam(),this.getOldCallback("checkbox_check")(e,t,i)},eachRow:function(e){this.rowInit(this.grid,e)},rowClick:function(e,t){var i=Event.findElement(t,"tr"),n="INPUT"==Event.element(t).tagName;if(i){var s=Element.select(i,"input");if(s[0]&&!s[0].disabled){var a=n?s[0].checked:!s[0].checked;this.grid.setCheckboxChecked(s[0],a)}}this.getOldCallback("row_click")(e,t)},inputChange:function(e){var t=Event.element(e);t&&t.checkboxElement&&t.checkboxElement.checked&&(this.gridData.get(t.checkboxElement.value)[t.name]=t.value,this.hiddenDataHolder.value=this.serializeObject())},rowInit:function(e,t){if(this.multidimensionalMode){var i=$(t).select(".checkbox")[0],n=this.inputsToManage.map(function(e){return['input[name="'+e+'"]','select[name="'+e+'"]']}),s=$(t).select.apply($(t),n.flatten());if(i&&s.length>0){i.inputElements=s;for(var a=0;a<s.length;a++)s[a].checkboxElement=i,this.gridData.get(i.value)&&this.gridData.get(i.value)[s[a].name]&&(s[a].value=this.gridData.get(i.value)[s[a].name]),s[a].disabled=!i.checked,s[a].tabIndex=this.tabIndex++,Event.observe(s[a],"keyup",this.inputChange.bind(this)),Event.observe(s[a],"change",this.inputChange.bind(this))}}this.getOldCallback("init_row")(e,t)},getGridDataHash:function(e){return $H(this.multidimensionalMode?e:this.convertArrayToObject(e))},getDataForReloadParam:function(){return this.multidimensionalMode?this.gridData.keys():this.gridData.values()},serializeObject:function(){if(this.multidimensionalMode){var e=this.gridData.clone();return e.each(function(t){e.set(t.key,encode_base64(Object.toQueryString(t.value)))}),e.toQueryString()}return this.gridData.values().join("&")},convertArrayToObject:function(e){for(var t={},i=0,n=e.length;n>i;i++)t[e[i]]=e[i];return t}};