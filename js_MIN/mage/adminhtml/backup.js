var AdminBackup=new Class.create;AdminBackup.prototype={initialize:function(){this.reset(),this.rollbackUrl=this.backupUrl="",this.rollbackValidator=new Validation($("rollback-form")),this.backupValidator=new Validation($("backup-form"))},reset:function(){this.time=0,this.type="",$("use-ftp-checkbox-row").hide(),$("use_ftp").checked=!1,$("ftp-credentials-container").hide(),$$("#ftp-credentials-container input").each(function(e){e.removeClassName("required-entry")}),$("backup_maintenance_mode").checked=!1,$("rollback_maintenance_mode").checked=!1,$("exclude_media").checked=!1,$("password").value="",$("backup_name").value="",$$(".validation-advice").invoke("remove"),$$("input").invoke("removeClassName","validation-failed"),$$("input").invoke("removeClassName","validation-passed"),$$(".backup-messages").invoke("hide"),$$("#ftp-credentials-container input").each(function(e){e.value=""})},backup:function(e){return this.reset(),this.type=e,this.showBackupWarning(),!1},rollback:function(e,t){return this.reset(),this.time=t,this.type=e,this.showRollbackWarning(),!1},showBackupWarning:function(){this.showPopup("backup-warning")},showRollbackWarning:function(){this.showPopup("rollback-warning")},requestBackupOptions:function(){this.hidePopups();var e="snapshot"!=this.type?"hide":"show";$$("#exclude-media-checkbox-container").invoke(e),this.showPopup("backup-options")},requestPassword:function(){this.hidePopups(),"db"!=this.type?$("use-ftp-checkbox-row").show():$("use-ftp-checkbox-row").hide(),this.showPopup("rollback-request-password")},toggleFtpCredentialsForm:function(){$("use_ftp").checked?$("ftp-credentials-container").show():$("ftp-credentials-container").hide();var e="rollback-request-password";$$("#ftp-credentials-container input").each(function(e){"ftp_path"!=e.name&&($("use_ftp").checked?e.addClassName("required-entry"):e.removeClassName("required-entry"))}),$(e).show().setStyle({marginTop:-$(e).getDimensions().height/2+"px"})},submitBackup:function(){if(this.backupValidator&&this.backupValidator.validate()){this.hidePopups();var e={type:this.type,maintenance_mode:$("backup_maintenance_mode").checked?1:0,backup_name:$("backup_name").value,exclude_media:$("exclude_media").checked?1:0};new Ajax.Request(this.backupUrl,{onSuccess:function(e){this.processResponse(e,"backup-options")}.bind(this),method:"post",parameters:e})}return!1},submitRollback:function(){if(this.rollbackValidator&&this.rollbackValidator.validate()){var e=this.getPostData();this.hidePopups(),new Ajax.Request(this.rollbackUrl,{onSuccess:function(e){this.processResponse(e,"rollback-request-password")}.bind(this),method:"post",parameters:e})}return!1},processResponse:function(e,t){if(e.responseText.isJSON()){var i=e.responseText.evalJSON();return i.error?(this.displayError(t,i.error),void this.showPopup(t)):void(i.redirect_url&&setLocation(i.redirect_url))}},displayError:function(e,t){var i=this.getErrorMessageHtml(t);$$("#"+e+" .backup-messages .messages").invoke("update",i),$$("#"+e+" .backup-messages").invoke("show")},getErrorMessageHtml:function(e){return'<li class="error-msg"><ul><li><span>'+e+"</span></li></ul></li>"},getPostData:function(){var e=$("rollback-form").serialize(!0);return e.time=this.time,e.type=this.type,e},showPopup:function(e){$(e).show().setStyle({marginTop:-$(e).getDimensions().height/2+"px"}),$("popup-window-mask").setStyle({height:$("html-body").getHeight()+"px"}).show()},hidePopups:function(){$$(".backup-dialog").each(Element.hide),$("popup-window-mask").hide()}};