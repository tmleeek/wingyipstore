var Variables={textareaElementId:null,variablesContent:null,dialogWindow:null,dialogWindowId:"variables-chooser",overlayShowEffectOptions:null,overlayHideEffectOptions:null,insertFunction:"Variables.insertVariable",init:function(e,i){$(e)&&(this.textareaElementId=e),i&&(this.insertFunction=i)},resetData:function(){this.variablesContent=null,this.dialogWindow=null},openVariableChooser:function(e){null==this.variablesContent&&e&&(this.variablesContent="<ul>",e.each(function(e){e.label&&e.value&&(this.variablesContent+="<li><b>"+e.label+"</b></li>",e.value.each(function(e){e.value&&e.label&&(this.variablesContent+='<li style="padding-left: 20px;">'+this.prepareVariableRow(e.value,e.label)+"</li>")}.bind(this)))}.bind(this)),this.variablesContent+="</ul>"),this.variablesContent&&this.openDialogWindow(this.variablesContent)},openDialogWindow:function(e){return $(this.dialogWindowId)&&"undefined"!=typeof Windows?void Windows.focus(this.dialogWindowId):(this.overlayShowEffectOptions=Windows.overlayShowEffectOptions,this.overlayHideEffectOptions=Windows.overlayHideEffectOptions,Windows.overlayShowEffectOptions={duration:0},Windows.overlayHideEffectOptions={duration:0},this.dialogWindow=Dialog.info(e,{draggable:!0,resizable:!0,closable:!0,className:"magento",windowClassName:"popup-window",title:"Insert Variable...",width:700,zIndex:1e3,recenterAuto:!1,hideEffect:Element.hide,showEffect:Element.show,id:this.dialogWindowId,onClose:this.closeDialogWindow.bind(this)}),void e.evalScripts.bind(e).defer())},closeDialogWindow:function(e){e||(e=this.dialogWindow),e&&(e.close(),Windows.overlayShowEffectOptions=this.overlayShowEffectOptions,Windows.overlayHideEffectOptions=this.overlayHideEffectOptions)},prepareVariableRow:function(e,i){var t=e.replace(/"/g,"&quot;").replace(/'/g,"\\&#39;"),o='<a href="#" onclick="'+this.insertFunction+"('"+t+"');return false;\">"+i+"</a>";return o},insertVariable:function(e){this.closeDialogWindow(this.dialogWindow);var i=$(this.textareaElementId);if(i){var t=i.scrollTop;updateElementAtCursor(i,e),i.focus(),i.scrollTop=t,i=null}}};MagentovariablePlugin={editor:null,variables:null,textareaId:null,setEditor:function(e){this.editor=e},loadChooser:function(e,i){this.textareaId=i,null==this.variables?new Ajax.Request(e,{parameters:{},onComplete:function(e){e.responseText.isJSON()&&(Variables.init(null,"MagentovariablePlugin.insertVariable"),this.variables=e.responseText.evalJSON(),this.openChooser(this.variables))}.bind(this)}):this.openChooser(this.variables)},openChooser:function(e){Variables.openVariableChooser(e)},insertVariable:function(e){this.textareaId?(Variables.init(this.textareaId),Variables.insertVariable(e)):(Variables.closeDialogWindow(),this.editor.execCommand("mceInsertContent",!1,e))}};